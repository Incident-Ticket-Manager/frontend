<div class="project-detail-content" *ngIf="!!project">
  <p (click)="goBack()" class="back__button"><mat-icon>arrow_back</mat-icon> Revenir à l'accueil</p>
  <h1>Projet {{ project.name }}</h1>
  <section>
    <h2>A Propos</h2>
    <div>Date de création: {{ project.date | date: 'dd-MM-yyyy' }}</div>
    <div>Administrateur: {{ project.admin }}</div>
  </section>

  <section>
    <h2>Incidents en cours</h2>
    <table mat-table [dataSource]="dataSource">
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef class="table-column">Numéro</th>
        <td mat-cell *matCellDef="let ticket">{{ ticket.id }}</td>
      </ng-container>

      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef class="table-column">Date</th>
        <td mat-cell *matCellDef="let ticket">{{ ticket.date }}</td>
      </ng-container>

      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef class="table-column">Intitulé</th>
        <td mat-cell *matCellDef="let ticket">{{ ticket.title }}</td>
      </ng-container>

      <ng-container matColumnDef="client">
        <th mat-header-cell *matHeaderCellDef class="table-column">Client</th>
        <td mat-cell *matCellDef="let ticket">{{ ticket.client.name }}</td>
      </ng-container>

      <ng-container matColumnDef="state">
        <th mat-header-cell *matHeaderCellDef class="table-column">Avancement</th>
        <td mat-cell *matCellDef="let ticket">{{ ticket.status | status }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="DISPLAYED_COLUMNS"></tr>
      <tr mat-row *matRowDef="let ticket; columns: DISPLAYED_COLUMNS;" (click)="openTicketDetail(ticket)"></tr>
    </table>
    <mat-paginator #paginator [length]="project.tickets.length" [pageSize]="5" [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
  </section>

  <section>
    <h2>Statistiques globales</h2>
    <div>Nombre total d'incidents: {{ project.ticketStats.total }}</div>
    <div>Nombre d'incidents ouverts: {{ project.ticketStats.open }}</div>
    <div>Nombre d'incidents en cours: {{ project.ticketStats.inProgress }}</div>
    <div>Nombre d'incidents résolus: {{ project.ticketStats.resolved }}</div>
  </section>

  <section>
    <h2>Statistiques mensuelles</h2>
    <ng-container *ngFor="let monthStatKey of monthStatsKeys; let i = index">
      Nombre de tickets en <app-timestamp-to-date [date]="monthStatKey" [ticketsNumber]="monthStatsValues[i]"></app-timestamp-to-date>
    </ng-container>
  </section>

  <div class="buttons-block">
    <button mat-raised-button color="primary" class="float__button" (click)="onAddTicketClick()">Créer un incident</button>
    <button mat-stroked-button color="primary" class="float__button" *ngIf="project.isAdmin" (click)="onDeleteClick()">Supprimer le projet</button>
  </div>
</div>
